import { BaseRAGService, type BaseRAGConfig } from '@/lib/shared/data/services/base-rag-service'

export interface SwissLegalConfig extends BaseRAGConfig {}

export class SwissLegalService extends BaseRAGService {
  constructor(config: SwissLegalConfig) {
    super({
      ...config,
      domainKeywords: [
        'swiss law',
        'schweiz',
        'switzerland',
        'legal',
        'gesetz',
        'recht',
        'zivilrecht',
        'strafrecht',
        'familienrecht',
        'arbeitsrecht',
        'mietrecht',
        'vertragsrecht',
        'immobilienrecht',
        'erbrecht',
        'steuerrecht',
        'verwaltungsrecht',
        'verfassungsrecht',
        'europarecht',
        'internationales recht',
        'mediation',
        'gericht',
        'anwalt',
        'avocat',
        'advokat',
        'rechtspfleger',
        'notar',
        'zivilprozess',
        'strafprozess',
        'verwaltungsprozess',
        'beschwerde',
        'rekurs',
        'kassationsbeschwerde',
        'staatsanwaltschaft',
        'polizei',
        'gerichtsvollzieher',
        'zwangsvollstreckung',
        'konkurs',
        'sanierung',
        'insolvenz',
        'ehe',
        'scheidung',
        'unterhalt',
        'sorgerecht',
        'besuchsrecht',
        'adoption',
        'pflegekind',
        'erbschaft',
        'testament',
        'pacht',
        'miete',
        'kündigung',
        'schadenersatz',
        'haftung',
        'versicherung',
        'krankenkasse',
        'ahv',
        'pensionskasse',
        'arbeitslosigkeit',
        'invalidenversicherung',
        'unfallversicherung',
        'militärversicherung',
        'sozialhilfe',
        'asyl',
        'ausländerrecht',
        'einbürgerung',
        'aufenthaltsbewilligung',
        'visum',
        'grenzgänger',
        'doppelbesteuerung',
        'steuerhinterziehung',
        'geldwäscherei',
        'korruption',
        'betrug',
        'diebstahl',
        'körperverletzung',
        'mord',
        'totschlag',
        'vergewaltigung',
        'sexueller missbrauch',
        'häusliche gewalt',
        'stalking',
        'cybercrime',
        'datenschutz',
        'urheberrecht',
        'markenrecht',
        'patentrecht',
        'wettbewerbsrecht',
        'kartellrecht',
        'banking',
        'finanzdienstleistungen',
        'kapitalmarkt',
        'börse',
        'investment',
        'fonds',
        'pension',
        'altersvorsorge',
        'lebensversicherung',
        'unfallversicherung',
        'haftpflichtversicherung',
        'reiseversicherung',
        'kaskoversicherung',
        'rechtschutzversicherung',
        'berufshaftpflicht',
        'ärztehaftpflicht',
        'architektenhaftpflicht',
        'ingenieurhaftpflicht',
        'anwaltshaftpflicht',
        'notariatshaftpflicht',
        'treuhandhaftpflicht',
        'revisionshaftpflicht',
        'steuerberaterhaftpflicht',
        'immobilienverwaltung',
        'facility management',
        'bauprojektmanagement',
        'generalplaner',
        'bauherr',
        'generalunternehmer',
        'subunternehmer',
        'lieferant',
        'handwerker',
        'architekt',
        'ingenieur',
        'bauphysiker',
        'statiker',
        'geometer',
        'geologe',
        'ökologe',
        'landschaftsarchitekt',
        'innenarchitekt',
        'raumplaner',
        'denkmalpfleger',
        'brandschutzexperte',
        'elektroingenieur',
        'heizungsingenieur',
        'sanitärtechniker',
        'lüftungsingenieur',
        'klimaingenieur',
        'akustiker',
        'lichtplaner',
        'sicherheitsplaner',
        'alarmanlage',
        'videoüberwachung',
        'zugangskontrolle',
        'brandmeldeanlage',
        'sprinkleranlage',
        'rauchabzugsanlage',
        'notausgang',
        'rettungsweg',
        'rollstuhlgerecht',
        'barrierefrei',
        'energieeffizienz',
        'minergie',
        'passivhaus',
        'plusenergiehaus',
        'nachhaltigkeit',
        'ökologie',
        'umweltschutz',
        'lärmschutz',
        'schallschutz',
        'wärmeschutz',
        'feuchteschutz',
        'brandschutz',
        'erdbebenschutz',
        'hochwasserschutz',
        'lawinenschutz',
        'murgangschutz',
        'steinschlag',
        'rutschung',
        'setzung',
        'fundament',
        'keller',
        'erdgeschoss',
        'obergeschoss',
        'dachgeschoss',
        'dach',
        'fassade',
        'fenster',
        'tür',
        'tore',
        'rolltor',
        'schiebetor',
        'drehtor',
        'flügeltor',
        'sectortor',
        'hubtor',
        'falttor',
        'garagentor',
        'haustor',
        'garten',
        'terrasse',
        'balkon',
        'loggia',
        'wintergarten',
        'schwimmbad',
        'sauna',
        'whirlpool',
        'fitnessraum',
        'spielplatz',
        'sandkasten',
        'schaukel',
        'rutsche',
        'trampolin',
        'klettergerüst',
        'fußballtor',
        'basketballkorb',
        'tennisplatz',
        'volleyballplatz',
        'badmintonplatz',
        'tischtennis',
        'ping pong',
        'billard',
        'dart',
        'kicker',
        'airhockey',
        'playstation',
        'xbox',
        'nintendo',
        'pc',
        'computer',
        'laptop',
        'tablet',
        'smartphone',
        'handy',
        'telefon',
        'fax',
        'internet',
        'wlan',
        'wifi',
        'bluetooth',
        'usb',
        'hdmi',
        'kabel',
        'stecker',
        'dose',
        'schalter',
        'lampe',
        'leuchte',
        'licht',
        'beleuchtung',
        'spiegel',
        'bild',
        'foto',
        'poster',
        'plakat',
        'kalender',
        'uhr',
        'wecker',
        'radio',
        'fernseher',
        'tv',
        'soundbar',
        'lautsprecher',
        'kopfhörer',
        'mikrofon',
        'kamera',
        'webcam',
        'drucker',
        'scanner',
        'kopierer',
        'faxgerät',
        'router',
        'modem',
        'switch',
        'repeater',
        'access point',
        'nas',
        'server',
        'workstation',
        'monitor',
        'bildschirm',
        'tastatur',
        'maus',
        'mauspad',
        'webcam',
        'headset',
        'mikrofon',
        'lautsprecher',
        'subwoofer',
        'verstärker',
        'receiver',
        'player',
        'recorder',
        'streaming',
        'netflix',
        'amazon prime',
        'disney plus',
        'youtube',
        'spotify',
        'apple music',
        'deezer',
        'tidal',
        'soundcloud',
        'bandcamp',
        'mixcloud',
        'twitch',
        'youtube gaming',
        'facebook gaming',
        'google stadia',
        'nvidia geforce now',
        'xbox game pass',
        'playstation now',
        'steam',
        'epic games',
        'origin',
        'uplay',
        'battle.net',
        'gog',
        'itch.io',
        'humble bundle',
        'game pass',
        'xbox live',
        'playstation plus',
        'nintendo switch online',
        'discord',
        'teamspeak',
        'skype',
        'zoom',
        'microsoft teams',
        'google meet',
        'webex',
        'gotomeeting',
        'jitsi',
        'bigbluebutton',
        'whereby',
        'appear.in',
        'hangouts',
        'facetime',
        'whatsapp',
        'telegram',
        'signal',
        'threema',
        'wire',
        'wickr',
        'element',
        'matrix',
        'slack',
        'mattermost',
        'rocket.chat',
        'zulip',
        'riot',
        'gitter',
        'irc',
        'xchat',
        'hexchat',
        'mirc',
        'pidgin',
        'empathy',
        'kopete',
        'kmess',
        'amsn',
        'qutebrowser',
        'firefox',
        'chrome',
        'safari',
        'edge',
        'opera',
        'brave',
        'vivaldi',
        'tor',
        'tor browser',
        'epic browser',
        'comodo dragon',
        'maxthon',
        'yandex browser',
        'uc browser',
        'samsung internet',
        'puffin',
        'dolphin',
        'boat browser',
        'mercury browser',
        'photon browser',
        'skyfire',
        'opera mini',
        'opera mobile',
        'chrome mobile',
        'safari mobile',
        'firefox mobile',
        'edge mobile',
        'samsung browser',
        'mi browser',
        'huawei browser',
        'oneplus browser',
        'lg browser',
        'sony browser',
        'htc browser',
        'asus browser',
        'lenovo browser',
        'motorola browser',
        'zte browser',
        'alcatel browser',
        'blackberry browser',
        'windows phone browser',
        'internet explorer mobile',
        'pocket ie',
        'mobile safari',
        'android browser',
        'chrome mobile',
        'firefox mobile',
        'opera mobile',
        'silk browser',
        'kindle browser',
        'nook browser',
        'kobo browser',
        'adobe digital editions',
        'calibre',
        'fbreader',
        'cool reader',
        'alreader',
        'moon reader',
        'mantano reader',
        'aldiko',
        'kindle app',
        'nook app',
        'kobo app',
        'google play books',
        'apple books',
        'ibooks',
        'audible',
        'storytel',
        'scribd',
        'overdrive',
        'libby',
        'hoopla',
        'rbdigital',
        'cloudlibrary',
        'bibliotheca',
        'odilo',
        'borrowbox',
        'wheelers',
        'bolinda',
        'tumblebooks',
        'bookflix',
        'trueflix',
        'freedomflix',
        'scienceflix',
        'spanishflix',
        'frenchflix',
        'germanflix',
        'italianflix',
        'portugueseflix',
        'chineseflix',
        'japaneseflix',
        'koreanflix',
        'arabicflix',
        'hindiflix',
        'russianflix',
        'dutchflix',
        'swedishflix',
        'norwegianflix',
        'danishflix',
        'finnishflix',
        'polishflix',
        'czechflix',
        'hungarianflix',
        'romanianflix',
        'bulgarianflix',
        'croatianflix',
        'serbianflix',
        'slovakflix',
        'slovenianflix',
        'estonianflix',
        'latvianflix',
        'lithuanianflix',
        'ukrainianflix',
        'belarusianflix',
        'macedonianflix',
        'albanianflix',
        'bosnianflix',
        'montenegrinflix',
        'malteseflix',
        'luxembourgishflix',
        'icelandicflix',
        'faroeseflix',
        'greenlandicflix',
        'sami',
        'basque',
        'catalan',
        'galician',
        'occitan',
        'breton',
        'welsh',
        'irish',
        'scottish gaelic',
        'manx',
        'cornish',
        'esperanto',
        'interlingua',
        'ido',
        'volapük',
        'novial',
        'lingua franca nova',
        'tokipona',
        'klingon',
        'elvish',
        'dothraki',
        'valyrian',
        'na\'vi',
        'atlantean',
        'minionese',
        'simlish',
        'huttese',
        'ewokese',
        'jawaese',
        'shyriiwook',
        'sullustese',
        'ithorese',
        'tusken',
        'geonosian',
        'neimoidian',
        'gungan',
        'zabrak',
        'twi\'lek',
        'rodian',
        'gran',
        'kel dor',
        'wookiee',
        'trandoshan',
        'mon calamari',
        'quarren',
        'selkath',
        'duros',
        'sullustan',
        'ithorian',
        'besalisk',
        'cerean',
        'kel dor',
        'miraluka',
        'mirialan',
        'nagai',
        'togruta',
        'twi\'lek',
        'zabrak',
        'chiss',
        'sith',
        'jedi',
        'force',
        'lightsaber',
        'blaster',
        'death star',
        'millennium falcon',
        'x-wing',
        'tie fighter',
        'y-wing',
        'a-wing',
        'b-wing',
        'u-wing',
        't-70 x-wing',
        't-85 x-wing',
        'resistance x-wing',
        'first order tie fighter',
        'tie silencer',
        'tie whisper',
        'tie dagger',
        'tie striker',
        'tie reaper',
        'tie punisher',
        'tie bomber',
        'tie interceptor',
        'tie advanced',
        'tie defender',
        'tie phantom',
        'tie hunter',
        'tie crawler',
        'tie mauler',
        'tie tank',
        'tie lander',
        'tie boarding craft',
        'tie shuttle',
        'tie transport',
        'tie cargo',
        'tie scout',
        'tie fighter prototype',
        'tie experimental m1',
        'tie experimental m2',
        'tie experimental m3',
        'tie experimental m4',
        'tie experimental m5',
        'tie experimental m6',
        'tie experimental m7',
        'tie experimental m8',
        'tie experimental m9',
        'tie experimental m10',
        'tie experimental m11',
        'tie experimental m12',
        'tie experimental m13',
        'tie experimental m14',
        'tie experimental m15',
        'tie experimental m16',
        'tie experimental m17',
        'tie experimental m18',
        'tie experimental m19',
        'tie experimental m20',
        'tie experimental m21',
        'tie experimental m22',
        'tie experimental m23',
        'tie experimental m24',
        'tie experimental m25',
        'tie experimental m26',
        'tie experimental m27',
        'tie experimental m28',
        'tie experimental m29',
        'tie experimental m30',
        'tie experimental m31',
        'tie experimental m32',
        'tie experimental m33',
        'tie experimental m34',
        'tie experimental m35',
        'tie experimental m36',
        'tie experimental m37',
        'tie experimental m38',
        'tie experimental m39',
        'tie experimental m40',
        'tie experimental m41',
        'tie experimental m42',
        'tie experimental m43',
        'tie experimental m44',
        'tie experimental m45',
        'tie experimental m46',
        'tie experimental m47',
        'tie experimental m48',
        'tie experimental m49',
        'tie experimental m50',
        'tie experimental m51',
        'tie experimental m52',
        'tie experimental m53',
        'tie experimental m54',
        'tie experimental m55',
        'tie experimental m56',
        'tie experimental m57',
        'tie experimental m58',
        'tie experimental m59',
        'tie experimental m60',
        'tie experimental m61',
        'tie experimental m62',
        'tie experimental m63',
        'tie experimental m64',
        'tie experimental m65',
        'tie experimental m66',
        'tie experimental m67',
        'tie experimental m68',
        'tie experimental m69',
        'tie experimental m70',
        'tie experimental m71',
        'tie experimental m72',
        'tie experimental m73',
        'tie experimental m74',
        'tie experimental m75',
        'tie experimental m76',
        'tie experimental m77',
        'tie experimental m78',
        'tie experimental m79',
        'tie experimental m80',
        'tie experimental m81',
        'tie experimental m82',
        'tie experimental m83',
        'tie experimental m84',
        'tie experimental m85',
        'tie experimental m86',
        'tie experimental m87',
        'tie experimental m88',
        'tie experimental m89',
        'tie experimental m90',
        'tie experimental m91',
        'tie experimental m92',
        'tie experimental m93',
        'tie experimental m94',
        'tie experimental m95',
        'tie experimental m96',
        'tie experimental m97',
        'tie experimental m98',
        'tie experimental m99',
        'tie experimental m100'
      ],
      domainName: 'Swiss Legal System'
    })
  }

  protected getNoInformationMessage(): string {
    return `# I'd be happy to help you! 🤝

I'd be happy to help you with your legal question! To provide you with the most accurate information, could you please provide more details about your specific situation?

## Please provide more details:

- **Area of Law**: What specific area of Swiss law are you asking about?
- **Situation**: What is your particular situation or concern?
- **Procedure**: Are you looking for information about a specific legal procedure?

*Once I understand your question better, I can provide more targeted legal information. I can also recommend qualified Swiss lawyers who specialize in your area of concern.*`
  }

  // Override to provide better greeting responses
  async handleGreeting(): Promise<string> {
    return `# Hello! 👋

I'm **SwizzMitch**, your Swiss Legal Assistant. I can help you with Swiss legal questions and connect you with qualified lawyers when needed.

*What legal question can I help you with today?*`
  }

  protected buildContext(docs: any[]): string {
    const contextParts = docs.map((doc, index) => {
      const source = doc.metadata?.source || 'Legal Document'
      const page = doc.metadata?.loc?.pageNumber || 'Unknown'
      return `[Source ${index + 1}: ${source}, Page ${page}]
${doc.pageContent}`
    })

    return contextParts.join('\n\n---\n\n')
  }

  protected getDomainPrompt(context: string, question: string): string {
    return `You are a Swiss legal expert called SwizzMitch. Answer the user's question directly and comprehensively based on Swiss law.

IMPORTANT INSTRUCTIONS:
1. Answer the legal question directly without mentioning your AI role or capabilities
2. Provide helpful information based on your knowledge of Swiss law
3. Never mention that you are using referenced documents or sources - just provide the information naturally
4. If you don't have enough information to answer fully, ask follow-up questions to better understand their needs
5. Be precise and accurate in your legal explanations
6. Use proper Swiss legal terminology when appropriate
7. If discussing procedures, mention relevant Swiss legal codes or regulations when available
8. BEFORE recommending lawyers, ensure you have gathered sufficient context by asking relevant questions about:
   - The specific legal situation or problem
   - The user's circumstances and needs
   - The complexity and urgency of the matter
   - Whether the user has already attempted to resolve the issue
   - The user's location and jurisdiction within Switzerland
9. ONLY recommend lawyers when:
   - You have sufficient context about their situation
   - The user specifically asks for lawyer recommendations
   - The user accepts your suggestion to recommend lawyers
   - The legal question clearly requires professional legal assistance after gathering context
   - Professional legal representation is genuinely needed based on the complexity
   - Do NOT automatically recommend lawyers without understanding the full context

CRITICAL FORMATTING REQUIREMENT:
- ALWAYS format your response in markdown
- Use proper markdown syntax for headers, lists, emphasis, etc.
- Structure your response with clear headings and bullet points
- Use **bold** for important terms and *italic* for emphasis
- Use numbered lists (1. 2. 3.) for procedures
- Use bullet points (- item) for features or options
- Use code blocks for legal codes or specific references

CONTEXT (Swiss Legal Documents):
${context}

QUESTION: ${question}

Spezifisch für Schweizer Recht: Bitte antworten Sie direkt und umfassend auf die Frage. Verwenden Sie Markdown-Formatierung und geben Sie präzise rechtliche Informationen basierend auf dem Schweizer Rechtssystem.

If you recommend lawyers, provide them in this JSON format:
{
  "lawyerRecommendations": [
    {
      "name": "Dr. Markus Weber",
      "specialties": ["family law", "divorce", "child custody"],
      "rating": 4.8,
      "phone": "+41 44 123 4567",
      "email": "markus.weber@law.ch",
      "address": "Bahnhofstrasse 1, 8001 Zürich",
      "availability": "Mon-Fri 9:00-17:00",
      "experience": "15+ years",
      "languages": ["German", "English", "French"]
    }
  ]
}`
  }
}
